import{a as P}from"./chunk-LJ5LN32T.js";import{a as h}from"./chunk-C7XZ7IYY.js";import{B as G,D as H,Wa as R,Ya as O,bc as K}from"./chunk-HSKCSBWS.js";import{l as N}from"./chunk-KV5YFX3I.js";import{Ac as T,Ba as E,Fc as n,Hc as d,Wb as c,Xb as r,Yb as s,Zb as m,aa as A,cb as i,ed as S,fa as j,na as f,od as k,qc as l,rb as W,td as V,xb as p,yc as M,zc as F}from"./chunk-7GBT3Z6V.js";import{a as g,b as x}from"./chunk-ZOGHMS73.js";var C=class C{constructor(){}processCardData(e,t){let o=this.calculateStats(e),v=this.calculateStats(t),w=this.calculatePercentageChange(v.voltajePromedio,o.voltajePromedio),b=this.calculatePercentageChange(v.amperajeTotal,o.amperajeTotal),u=this.calculatePercentageChange(v.consumoTotal,o.consumoTotal);return{voltaje:{actual:o.voltajePromedio,cambio:Math.abs(w),esPositivo:w>=0},amperaje:{actual:o.amperajeTotal,cambio:Math.abs(b),esPositivo:b>=0},consumoKWH:{actual:o.consumoTotal,cambio:Math.abs(u),esPositivo:u>=0}}}calculateStats(e){if(!e||e.length===0)return{voltajePromedio:0,amperajeTotal:0,consumoTotal:0};let t=new Date,o=e.filter(u=>new Date(u.fecha_creacion)<=t);if(o.length===0)return{voltajePromedio:0,amperajeTotal:0,consumoTotal:0};let v=o.reduce((u,y)=>u+y.voltaje,0)/o.length,w=o.reduce((u,y)=>u+y.corriente,0),b=o.reduce((u,y)=>u+y.energia_acumulada_calc,0);return{voltajePromedio:Math.round(v*100)/100,amperajeTotal:Math.round(w*100)/100,consumoTotal:Math.round(b*100)/100}}calculatePercentageChange(e,t){if(e===0)return t>0?100:0;let o=(t-e)/e*100;return Math.round(o*100)/100}getEmptyCardData(){return{voltaje:{actual:0,cambio:0,esPositivo:!0},amperaje:{actual:0,cambio:0,esPositivo:!0},consumoKWH:{actual:0,cambio:0,esPositivo:!0}}}};C.\u0275fac=function(t){return new(t||C)},C.\u0275prov=A({token:C,factory:C.\u0275fac,providedIn:"root"});var I=C;function z(a,e){if(a&1&&(r(0,"span"),n(1),f(),m(2,"svg",15),n(3,`)
          `),s()),a&2){let t=l(2);i(),d(`
            (+`,t.voltageChangeFormatted,"% ")}}function L(a,e){if(a&1&&(n(0),f(),m(1,"svg",16),n(2,`)
          `)),a&2){let t=l(2);d(`
            (-`,t.voltageChangeFormatted,"% ")}}function q(a,e){if(a&1&&(n(0,`
        `),r(1,"span",12),n(2),s(),n(3,`
        `),r(4,"span",13),n(5,`
          `),p(6,z,4,1,"span",14),n(7,`
          `),p(8,L,3,1,"ng-template",null,0,S),n(10,`
        `),s(),n(11,`
      `)),a&2){let t=T(9),o=l();i(2),d("",o.formattedVoltage,"V"),i(4),c("ngIf",o.cardData.voltaje.esPositivo)("ngIfElse",t)}}function U(a,e){if(a&1&&m(0,"c-chart",17),a&2){let t=l();c("data",t.data[0])("options",t.options[0])("type","line")}}function X(a,e){if(a&1&&(r(0,"span"),n(1),f(),m(2,"svg",15),n(3,`)
          `),s()),a&2){let t=l(2);i(),d(`
            (+`,t.currentChangeFormatted,"% ")}}function Y(a,e){if(a&1&&(n(0),f(),m(1,"svg",16),n(2,`)
          `)),a&2){let t=l(2);d(`
            (-`,t.currentChangeFormatted,"% ")}}function Z(a,e){if(a&1&&(n(0,`
        `),r(1,"span",12),n(2),s(),n(3,`
        `),r(4,"span",13),n(5,`
          `),p(6,X,4,1,"span",14),n(7,`
          `),p(8,Y,3,1,"ng-template",null,1,S),n(10,`
        `),s(),n(11,`
      `)),a&2){let t=T(9),o=l();i(2),d("",o.formattedCurrent,"A"),i(4),c("ngIf",o.cardData.amperaje.esPositivo)("ngIfElse",t)}}function $(a,e){if(a&1&&m(0,"c-chart",18),a&2){let t=l();c("data",t.data[1])("options",t.options[1])}}function tt(a,e){if(a&1&&(r(0,"span"),n(1),f(),m(2,"svg",15),n(3,`)
          `),s()),a&2){let t=l(2);i(),d(`
            (+`,t.consumptionChangeFormatted,"% ")}}function et(a,e){if(a&1&&(n(0),f(),m(1,"svg",16),n(2,`)
          `)),a&2){let t=l(2);d(`
            (-`,t.consumptionChangeFormatted,"% ")}}function at(a,e){if(a&1&&(n(0,`
        `),r(1,"span",12),n(2),s(),n(3,`
        `),r(4,"span",13),n(5,`
          `),p(6,tt,4,1,"span",14),n(7,`
          `),p(8,et,3,1,"ng-template",null,2,S),n(10,`
        `),s(),n(11,`
      `)),a&2){let t=T(9),o=l();i(2),d("",o.formattedConsumption," KWH"),i(4),c("ngIf",o.cardData.consumoKWH.esPositivo)("ngIfElse",t)}}function nt(a,e){if(a&1&&m(0,"c-chart",19),a&2){let t=l();c("data",t.data[2])("options",t.options[2])}}function ot(a,e){if(a&1&&(r(0,"span"),n(1),f(),m(2,"svg",15),n(3,`)
          `),s()),a&2){let t=l(2);i(),d(`
            (+`,t.costChangeFormatted,"% ")}}function it(a,e){if(a&1&&(n(0),f(),m(1,"svg",16),n(2,`)
          `)),a&2){let t=l(2);d(`
            (-`,t.costChangeFormatted,"% ")}}function rt(a,e){if(a&1&&(n(0,`
        `),r(1,"span",12),n(2),s(),n(3,`
        `),r(4,"span",13),n(5,`
          `),p(6,ot,4,1,"span",14),n(7,`
          `),p(8,it,3,1,"ng-template",null,3,S),n(10,`
        `),s(),n(11,`
      `)),a&2){let t=T(9),o=l();i(2),d("",o.formattedCostGTQ," GTQ"),i(4),c("ngIf",o.cardData.consumoKWH.esPositivo)("ngIfElse",t)}}function st(a,e){if(a&1&&m(0,"c-chart",20),a&2){let t=l();c("data",t.data[3])("options",t.options[3])}}var lt=["chart"],_=class _{constructor(){this.changeDetectorRef=j(V);this.cardDataService=j(I);this.currentPeriod="Month";this.currentConsumption=0;this.currentApiData=[];this.previousApiData=[];this.data=[];this.options=[];this.cardData=this.cardDataService.getEmptyCardData();this.labels=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre","Enero","Febrero","Marzo","Abril"];this.datasets=[[{label:"Voltaje (V)",backgroundColor:"transparent",borderColor:"rgba(255,255,255,.55)",pointBackgroundColor:h("--cui-primary"),pointHoverBorderColor:h("--cui-primary"),data:[65,59,80,84,51,55,40]}],[{label:"Amperaje (A)",backgroundColor:"transparent",borderColor:"rgba(255,255,255,.55)",pointBackgroundColor:h("--cui-info"),pointHoverBorderColor:h("--cui-info"),data:[1,18,9,17,34,22,11]}],[{label:"Consumo (kWh)",backgroundColor:"rgba(255,255,255,.2)",borderColor:"rgba(255,255,255,.55)",pointBackgroundColor:h("--cui-warning"),pointHoverBorderColor:h("--cui-warning"),data:[78,81,80,45,34,12,40],fill:!0}],[{label:"Costo (GTQ)",backgroundColor:"rgba(255,255,255,.2)",borderColor:"rgba(255,255,255,.55)",data:[78,81,80,45,34,12,40,85,65,23,12,98,34,84,67,82],barPercentage:.7}]];this.optionsDefault={plugins:{legend:{display:!1}},maintainAspectRatio:!1,scales:{x:{border:{display:!1},grid:{display:!1,drawBorder:!1},ticks:{display:!1}},y:{min:30,max:89,display:!1,grid:{display:!1},ticks:{display:!1}}},elements:{line:{borderWidth:1,tension:.4},point:{radius:4,hitRadius:10,hoverRadius:4}}}}get conversionRate(){let e=localStorage.getItem("parametrosMonitoreo");return e?JSON.parse(e).valorKwh:1.51}get currentCostGTQ(){return this.cardData.consumoKWH.actual*this.conversionRate}formatNumber(e){return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}ngOnChanges(e){(e.currentApiData||e.previousApiData)&&this.updateCardData()}updateCardData(){this.currentApiData.length>0?this.cardData=this.cardDataService.processCardData(this.currentApiData,this.previousApiData):this.cardData=this.cardDataService.getEmptyCardData()}get formattedVoltage(){return this.formatNumber(this.cardData.voltaje.actual)}get formattedCurrent(){return this.formatNumber(this.cardData.amperaje.actual)}get formattedConsumption(){return this.formatNumber(this.cardData.consumoKWH.actual)}get formattedCostGTQ(){return this.formatNumber(this.currentCostGTQ)}get voltageChangeFormatted(){return this.formatNumber(this.cardData.voltaje.cambio)}get currentChangeFormatted(){return this.formatNumber(this.cardData.amperaje.cambio)}get consumptionChangeFormatted(){return this.formatNumber(this.cardData.consumoKWH.cambio)}get costChangeFormatted(){return this.formatNumber(this.cardData.consumoKWH.cambio)}ngOnInit(){this.setData()}ngAfterContentInit(){this.changeDetectorRef.detectChanges()}setData(){for(let e=0;e<4;e++)this.data[e]={labels:e<3?this.labels.slice(0,7):this.labels,datasets:this.datasets[e]};this.setOptions()}setOptions(){for(let e=0;e<4;e++){let t=JSON.parse(JSON.stringify(this.optionsDefault));switch(e){case 0:{this.options.push(t);break}case 1:{t.scales.y.min=-9,t.scales.y.max=39,t.elements.line.tension=0,this.options.push(t);break}case 2:{t.scales.x={display:!1},t.scales.y={display:!1},t.elements.line.borderWidth=2,t.elements.point.radius=0,this.options.push(t);break}case 3:{t.scales.x.grid={display:!1,drawTicks:!1},t.scales.x.grid={display:!1,drawTicks:!1,drawBorder:!1},t.scales.y.min=void 0,t.scales.y.max=void 0,t.elements={},this.options.push(t);break}}}}};_.\u0275fac=function(t){return new(t||_)},_.\u0275cmp=W({type:_,selectors:[["app-widgets-dropdown"]],inputs:{currentPeriod:"currentPeriod",currentConsumption:"currentConsumption",currentApiData:"currentApiData",previousApiData:"previousApiData"},features:[E],decls:17,vars:4,consts:[["negativeVoltage",""],["negativeCurrent",""],["negativeConsumption",""],["negativeCost",""],[1,"g-4"],["sm","6","xl","3"],["color","primary",3,"title"],["cTemplateId","widgetValueTemplate"],["cTemplateId","widgetChartTemplate"],["color","info",3,"title"],["color","warning",3,"title"],["color","danger",3,"title"],[2,"font-size","1.3rem","font-weight","600"],[1,"fw-normal",2,"font-size","10px"],[4,"ngIf","ngIfElse"],["cIcon","","name","cilArrowTop","size","sm"],["cIcon","","name","cilArrowBottom","size","sm"],["height","70",1,"mt-3","mx-3",3,"data","options","type"],["height","70","type","line",1,"mt-3","mx-3",3,"data","options"],["height","70","type","line",1,"mt-3",3,"data","options"],["height","70","type","bar",1,"mt-3","mx-3",3,"data","options"]],template:function(t,o){t&1&&(r(0,"c-row",4)(1,"c-col",5)(2,"c-widget-stat-a",6),p(3,q,12,3,"ng-template",7)(4,U,1,3,"ng-template",8),s()(),r(5,"c-col",5)(6,"c-widget-stat-a",9),p(7,Z,12,3,"ng-template",7)(8,$,1,2,"ng-template",8),s()(),r(9,"c-col",5)(10,"c-widget-stat-a",10),p(11,at,12,3,"ng-template",7)(12,nt,1,2,"ng-template",8),s()(),r(13,"c-col",5)(14,"c-widget-stat-a",11),p(15,rt,12,3,"ng-template",7)(16,st,1,2,"ng-template",8),s()()()),t&2&&(i(2),c("title","Voltaje"),i(4),c("title","Amperaje"),i(4),c("title","Consumos (KWH)"),i(4),c("title","Consumo Actual (GTQ)"))},dependencies:[N,O,R,K,H,G,P],encapsulation:2});var B=_,D=class D{constructor(){this.chartComponent=k.required("chart");this.colors={label:"My dataset",backgroundColor:"rgba(77,189,116,.2)",borderColor:"#4dbd74",pointHoverBackgroundColor:"#fff"};this.labels=["Mo","Tu","We","Th","Fr","Sa","Su"];this.data={labels:this.labels,datasets:[x(g({data:[65,59,84,84,51,55,40]},this.colors),{fill:{value:65}})]};this.options={maintainAspectRatio:!1,plugins:{legend:{display:!1}},elements:{line:{tension:.4}}}}ngAfterViewInit(){setTimeout(()=>{let e=()=>x(g({},this.data),{labels:["Jan","Feb","Mar","Apr","May"],datasets:[x(g({},this.data.datasets[0]),{data:[42,88,42,66,77],fill:{value:55}}),x(g({},this.data.datasets[0]),{borderColor:"#ffbd47",data:[88,42,66,77,42]})]}),t=["Jan","Feb","Mar","Apr","May"],o=[42,88,42,66,77],{datasets:v,labels:w}=g({},this.data),b=this.chartComponent()?.chart?.data.datasets.length;console.log("before",b),this.data=x(g({},this.data),{datasets:[x(g({},this.data.datasets[0]),{data:o}),x(g({},this.data.datasets[0]),{borderColor:"#ffbd47",data:[88,42,66,77,42]})],labels:t}),setTimeout(()=>{let u=this.chartComponent()?.chart?.data.datasets.length;console.log("after",u)})},5e3)}};D.\u0275fac=function(t){return new(t||D)},D.\u0275cmp=W({type:D,selectors:[["app-chart-sample"]],viewQuery:function(t,o){t&1&&M(o.chartComponent,lt,5),t&2&&F()},decls:2,vars:2,consts:[["chart",""],["type","line","width","300",3,"data","options"]],template:function(t,o){t&1&&m(0,"c-chart",1,0),t&2&&c("data",o.data)("options",o.options)},dependencies:[P],encapsulation:2});var Q=D;export{B as a};
