import{a as _}from"./chunk-XVUFOYT7.js";import{a as pe}from"./chunk-LJ5LN32T.js";import{A as ee,Ab as ce,C as te,Ea as le,Ob as me,Wa as se,X as oe,Ya as de,c as K,cc as ue,e as Q,f as O,h as J,ja as re,k as U,m as $,na as ae,o as q,oa as ie,p as Y,r as z,ra as ne,w as X,y as Z}from"./chunk-HSKCSBWS.js";import"./chunk-XX3OU7O5.js";import"./chunk-P5LOYQB2.js";import"./chunk-HEI3NBOD.js";import{m as j,u as L}from"./chunk-KV5YFX3I.js";import"./chunk-FPPZ4BUR.js";import"./chunk-QHBPP6FM.js";import{Ac as k,Cc as R,Fc as r,Gc as E,Hc as f,Sc as H,Uc as W,Wb as p,Xb as e,Yb as t,Zb as g,cb as s,fa as G,hc as V,la as P,ma as B,nc as F,rb as N}from"./chunk-7GBT3Z6V.js";import{h as I}from"./chunk-ZOGHMS73.js";var he=fe=>({color:fe,"font-weight":"bold"}),D=class D{constructor(){this.formBuilder=G(X);this.parquetService=G(_);this.voltajePromedio=0;this.corrientePromedio=0;this.consumoEstimadoKWH=0;this.consumoEstimadoGTQ=0;this.periodo="mes";this.lineChartData={labels:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio"],datasets:[{label:"Consumo 2024",backgroundColor:"rgba(151, 187, 205, 0.2)",borderColor:"rgba(151, 187, 205, 1)",pointBackgroundColor:"rgba(151, 187, 205, 1)",pointBorderColor:"#fff",data:[65,59,90,81,56,55,40]},{label:"Consumo 2025",backgroundColor:"rgba(220, 220, 220, 0.2)",borderColor:"rgba(220, 220, 220, 1)",pointBackgroundColor:"rgba(220, 220, 220, 1)",pointBorderColor:"#fff",data:[28,48,40,19,96,27,100]}]};this.lineChartOptions={plugins:{legend:{display:!0}},maintainAspectRatio:!1,scales:{x:{grid:{drawOnChartArea:!1}},y:{beginAtZero:!0}},elements:{line:{tension:.4}}};this.radarChartData={labels:["Ma\xF1ana","Medio d\xEDa","Tarde","Noche","Madrugada"],datasets:[{label:"Promedio de consumo",data:[65,59,90,81,56],fill:!0,backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgb(255, 99, 132)",pointBackgroundColor:"rgb(255, 99, 132)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(255, 99, 132)"}]};this.radarChartOptions={plugins:{legend:{display:!0}},maintainAspectRatio:!1,scales:{r:{angleLines:{display:!0}}}};this.formCheck1=this.formBuilder.group({checkbox1:!1,checkbox2:!1,checkbox3:!1});this.formRadio1=new J({radio1:new U("mes")})}get tarifaActual(){let a=localStorage.getItem("parametrosMonitoreo");return a?JSON.parse(a).valorKwh:1.51}ngOnInit(){this.resetearGraficos(),this.loadData("mes")}loadData(a){return I(this,null,function*(){try{let i;switch(a){case"dia":i=this.parquetService.getDayFilter();break;case"mes":i=this.parquetService.getMonthFilter();break;case"a\xF1o":i=this.parquetService.getYearFilter();break;default:i=this.parquetService.getDayFilter()}this.resetearValores(),this.parquetService.getFilteredData(i).subscribe({next:o=>{if(o.success&&o.data.length>0){let n=o.data.filter(l=>typeof l.voltaje=="number"&&typeof l.corriente=="number"&&typeof l.energia_acumulada_calc=="number");if(n.length>0){this.voltajePromedio=this.calcularPromedio(n,"voltaje"),this.corrientePromedio=this.calcularPromedio(n,"corriente");let l=n.reduce((S,x)=>S+x.energia_acumulada_calc,0),m=this.calcularFactorProyeccion(a);this.consumoEstimadoKWH=l*m,this.consumoEstimadoGTQ=this.consumoEstimadoKWH*this.tarifaActual,this.actualizarGraficos(n,a)}else console.warn("Los datos recibidos no son v\xE1lidos"),this.resetearGraficos()}else console.log("No hay datos disponibles para el per\xEDodo seleccionado"),this.resetearGraficos()},error:o=>{console.error("Error al cargar datos:",o),this.resetearValores(),this.resetearGraficos()},complete:()=>{setTimeout(()=>{},0)}})}catch(i){console.error("Error en loadData:",i),this.resetearValores(),this.resetearGraficos()}})}print(a){a.preventDefault(),window&&window.print()}setCheckBoxValue(a){let i=this.formCheck1.get(a)?.value,o=this.formCheck1.value;o[a]=!i,this.formCheck1.setValue(o)}setRadioValue(a){this.formRadio1.setValue({radio1:a}),this.periodo=a,this.loadData(a)}resetearValores(){this.voltajePromedio=0,this.corrientePromedio=0,this.consumoEstimadoKWH=0,this.consumoEstimadoGTQ=0}resetearGraficos(){this.lineChartData={labels:[],datasets:[{label:"Consumo Real",backgroundColor:"rgba(151, 187, 205, 0.2)",borderColor:"rgba(151, 187, 205, 1)",pointBackgroundColor:"rgba(151, 187, 205, 1)",pointBorderColor:"#fff",data:[]},{label:"Consumo Proyectado",backgroundColor:"rgba(220, 220, 220, 0.2)",borderColor:"rgba(220, 220, 220, 1)",pointBackgroundColor:"rgba(220, 220, 220, 1)",pointBorderColor:"#fff",data:[]}]},this.radarChartData={labels:["Ma\xF1ana","Medio d\xEDa","Tarde","Noche","Madrugada"],datasets:[{label:"Patr\xF3n de consumo",data:[0,0,0,0,0],fill:!0,backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgb(255, 99, 132)",pointBackgroundColor:"rgb(255, 99, 132)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(255, 99, 132)"}]}}obtenerFechaActual(){return new Date().toLocaleDateString("es-GT")}obtenerPeriodoAnalisis(){let a=new Date;switch(this.periodo){case"dia":return a.toLocaleDateString("es-GT");case"mes":return`${a.toLocaleString("es-GT",{month:"long"})} ${a.getFullYear()}`;case"a\xF1o":return a.getFullYear().toString();default:return a.toLocaleDateString("es-GT")}}obtenerTipoAnalisis(){switch(this.periodo){case"dia":return"Proyecci\xF3n Diaria";case"mes":return"Proyecci\xF3n Mensual";case"a\xF1o":return"Proyecci\xF3n Anual";default:return"Proyecci\xF3n Diaria"}}obtenerUmbralReferencia(){let a=localStorage.getItem("parametrosMonitoreo"),i={dia:333.33,mes:15e3,a\u00F1o:12e4};if(a){let n=JSON.parse(a),l=parseFloat(n.limiteMensualKwh);isNaN(l)||(i.mes=l,i.dia=l/30,i.a\u00F1o=l*12)}let o=i[this.periodo];return`${this.formatearNumero(o)} KWH ${this.periodo==="a\xF1o"?"anuales":this.periodo==="mes"?"mensuales":"diarios"}`}estaEnLimites(){let a=localStorage.getItem("parametrosMonitoreo"),i={dia:333.33,mes:15e3,a\u00F1o:12e4};if(a){let l=JSON.parse(a),m=parseFloat(l.limiteMensualKwh);isNaN(m)||(i.mes=m,i.dia=m/30,i.a\u00F1o=m*12)}let o=this.consumoEstimadoKWH,n=i[this.periodo];return o<=n}obtenerMensajeEstado(){let a=this.estaEnLimites(),i=this.consumoEstimadoKWH,o=this.obtenerUmbralReferencia();return a?`Consumo dentro de los l\xEDmites establecidos (${o})`:`\xA1Advertencia! El consumo supera el l\xEDmite establecido (${o})`}formatearNumero(a){return new Intl.NumberFormat("es-GT").format(a)}calcularPromedio(a,i){return a.length===0?0:a.reduce((n,l)=>{let m=l[i];return n+(typeof m=="number"?m:0)},0)/a.length}calcularFactorProyeccion(a){let i=new Date,o=i.getHours();switch(a){case"dia":return o<12?24/o:1;case"mes":let n=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),l=i.getDate();return l<n?n/l:1;case"a\xF1o":let m=i.getMonth()+1;return m<12?12/m:1;default:return 1}}calcularRegresionLineal(a){let i=a.length;if(i<2)return{pendiente:0,intercepto:a[0]||0};let o=Array.from({length:i},(h,c)=>c),n=a,l=o.reduce((h,c)=>h+c,0),m=n.reduce((h,c)=>h+c,0),S=o.reduce((h,c,b)=>h+c*n[b],0),x=o.reduce((h,c)=>h+c*c,0),w=(i*S-l*m)/(i*x-l*l),M=(m-w*l)/i;return{pendiente:w,intercepto:M}}actualizarGraficos(a,i){let o=[],n=[],l=[],m=new Date;if(i==="dia"){let c=m.getHours();for(let u=0;u<24;u++)if(o.push(`${u.toString().padStart(2,"0")}:00`),u<=c){let T=a.filter(y=>new Date(y.fecha_creacion).getHours()===u).reduce((y,v)=>y+v.energia_acumulada_calc,0);n.push(T)}else n.push(null);let b=n.filter(u=>u!==null),C=this.calcularRegresionLineal(b);for(let u=0;u<24;u++)u<=c?l.push(n[u]):l.push(C.intercepto+C.pendiente*u)}else if(i==="mes"){let c=m.getDate(),b=new Date(m.getFullYear(),m.getMonth()+1,0).getDate();for(let d=1;d<=b;d++)if(o.push(`${d.toString().padStart(2,"0")}`),d<=c){let y=a.filter(v=>new Date(v.fecha_creacion).getDate()===d).reduce((v,A)=>v+A.energia_acumulada_calc,0);n.push(y)}else n.push(null);let C=n.filter(d=>d!==null),u=this.calcularRegresionLineal(C);for(let d=0;d<b;d++)d<c?l.push(n[d]):l.push(u.intercepto+u.pendiente*d)}else{let c=m.getMonth(),b=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];for(let d=0;d<12;d++)if(o.push(b[d]),d<=c){let y=a.filter(v=>new Date(v.fecha_creacion).getMonth()===d).reduce((v,A)=>v+A.energia_acumulada_calc,0);n.push(y)}else n.push(null);let C=n.filter(d=>d!==null),u=this.calcularRegresionLineal(C);for(let d=0;d<12;d++)d<=c?l.push(n[d]):l.push(u.intercepto+u.pendiente*d)}let S=n.map(c=>c===null?0:c),x=l.map(c=>c===null?0:c);this.lineChartData={labels:o,datasets:[{label:"Consumo Real",backgroundColor:"rgba(151, 187, 205, 0.2)",borderColor:"rgba(151, 187, 205, 1)",pointBackgroundColor:"rgba(151, 187, 205, 1)",pointBorderColor:"#fff",data:S},{label:"Consumo Proyectado",backgroundColor:"rgba(255, 206, 86, 0.2)",borderColor:"rgba(255, 206, 86, 1)",pointBackgroundColor:"rgba(255, 206, 86, 1)",pointBorderColor:"#fff",data:x}]};let w=["Ma\xF1ana","Medio d\xEDa","Tarde","Noche","Madrugada"],M={Ma\u00F1ana:[6,7,8,9,10,11],"Medio d\xEDa":[12,13,14],Tarde:[15,16,17,18],Noche:[19,20,21,22],Madrugada:[23,0,1,2,3,4,5]},h=w.map(c=>{let b=M[c];return a.filter(u=>b.includes(new Date(u.fecha_creacion).getHours())).reduce((u,d)=>u+d.energia_acumulada_calc,0)});this.radarChartData={labels:w,datasets:[{label:"Patr\xF3n de consumo",data:h,fill:!0,backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgb(255, 99, 132)",pointBackgroundColor:"rgb(255, 99, 132)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(255, 99, 132)"}]}}};D.\u0275fac=function(i){return new(i||D)},D.\u0275cmp=N({type:D,selectors:[["app-button-groups"]],hostAttrs:[1,"app-body"],hostVars:2,hostBindings:function(i,o){i&2&&R("flex-row",!0)},features:[H([ee,_])],decls:224,vars:48,consts:[["widgetStatB1inv","cWidgetStatB"],["widgetStatB2inv","cWidgetStatB"],["widgetStatB3inv","cWidgetStatB"],["widgetStatB4inv","cWidgetStatB"],["xs","12"],[1,"mb-4"],[1,"d-flex","justify-content-between","align-items-center"],[3,"formGroup"],["aria-label","Basic radio toggle button group","role","group"],["formControlName","radio1","type","radio","value","dia",1,"btn-check"],["cButton","","cFormCheckLabel","","variant","outline",3,"click"],["formControlName","radio1","type","radio","value","mes","checked","",1,"btn-check"],["formControlName","radio1","type","radio","value","a\xF1o",1,"btn-check"],[1,"g-4"],["xl","3","md","6","sm","6"],["color","success-gradient","inverse","","text","Voltaje promedio registrado en el per\xEDodo",3,"title","value"],["thin","",1,"my-2",3,"white","value"],["color","info-gradient","inverse","","text","Corriente promedio registrada en el per\xEDodo",3,"title","value"],["color","warning-gradient","inverse","","text","Proyecci\xF3n del costo total para este per\xEDodo",3,"title","value"],["color","primary-gradient","inverse","","text","Proyecci\xF3n del consumo total del per\xEDodo",3,"title","value"],["xs","12","lg","6"],["type","line","height","300",3,"data","options"],["type","radar","height","300",3,"data","options"],["sm","4"],[1,"mb-3"],["cTable","",3,"hover","responsive","striped"],[1,"text-center"],[1,"text-end"],[1,"text-start"],[3,"ngStyle"],["lg","4","sm","5"],["lg","4","sm","5",1,"ms-auto"],["cTable","",3,"hover","responsive","color"]],template:function(i,o){if(i&1){let n=V();e(0,"c-col",4)(1,"c-card",5)(2,"c-card-header",6)(3,"div")(4,"strong"),r(5,"Proyeccion de Consumo"),t(),e(6,"span"),r(7),t()(),e(8,"form",7)(9,"c-button-group",8),g(10,"input",9),e(11,"label",10),F("click",function(){return P(n),B(o.setRadioValue("dia"))}),r(12,"D\xEDa"),t(),g(13,"input",11),e(14,"label",10),F("click",function(){return P(n),B(o.setRadioValue("mes"))}),r(15,"Mes"),t(),g(16,"input",12),e(17,"label",10),F("click",function(){return P(n),B(o.setRadioValue("a\xF1o"))}),r(18,"A\xF1o"),t()()()(),e(19,"c-card-body")(20,"c-row",13)(21,"c-col",14)(22,"c-widget-stat-b",15,0),g(24,"c-progress",16),t()(),e(25,"c-col",14)(26,"c-widget-stat-b",17,1),g(28,"c-progress",16),t()(),e(29,"c-col",14)(30,"c-widget-stat-b",18,2),g(32,"c-progress",16),t()(),e(33,"c-col",14)(34,"c-widget-stat-b",19,3),g(36,"c-progress",16),t()()()()()(),e(37,"c-row")(38,"c-col",20)(39,"c-card",5)(40,"c-card-header")(41,"strong"),r(42,"Gr\xE1fico de L\xEDnea"),t()(),e(43,"c-card-body"),g(44,"c-chart",21),t()()(),e(45,"c-col",20)(46,"c-card",5)(47,"c-card-header")(48,"strong"),r(49,"Gr\xE1fico de Radar"),t()(),e(50,"c-card-body"),g(51,"c-chart",22),t()()()(),e(52,"c-row")(53,"c-col",4)(54,"c-card")(55,"c-card-header")(56,"span"),r(57,"Proyeccion de Consumo "),e(58,"strong"),r(59),t()()(),e(60,"c-card-body")(61,"c-row",5)(62,"c-col",23)(63,"h6",24),r(64,"Monitoreo:"),t(),e(65,"div")(66,"strong"),r(67,"Edificio Zona 10"),t()(),e(68,"div"),r(69,"Direcci\xF3n: Ciudad de Guatemala"),t(),e(70,"div"),r(71,"Responsable: Ing. Jorge Mejicanos"),t(),e(72,"div"),r(73,"Email: jmejicanosr@miumg.edu.gt"),t(),e(74,"div"),r(75,"Sensor: MX-245-12"),t()(),e(76,"c-col",23)(77,"h6",24),r(78,"Cliente:"),t(),e(79,"div")(80,"strong"),r(81,"Area de Energia y Mantenimiento"),t()(),e(82,"div"),r(83,"Contacto: energia@empresa.com"),t(),e(84,"div"),r(85,"Zona 10, Ciudad de Guatemala"),t(),e(86,"div"),r(87),t(),e(88,"div"),r(89),t()(),e(90,"c-col",23)(91,"h6",24),r(92,"Detalle"),t(),e(93,"div"),r(94," Fecha Reporte "),e(95,"strong"),r(96),t()(),e(97,"div"),r(98),t(),e(99,"div"),r(100),t()()(),e(101,"table",25)(102,"thead")(103,"tr")(104,"th",26),r(105,"#"),t(),e(106,"th"),r(107,"Variable"),t(),e(108,"th"),r(109,"Descripci\xF3n"),t(),e(110,"th",26),r(111,"Valor promedio"),t(),e(112,"th",27),r(113,"Proyecci\xF3n"),t(),e(114,"th",27),r(115,"Unidad"),t()()(),e(116,"tbody")(117,"tr")(118,"td",26),r(119,"1"),t(),e(120,"td",28),r(121,"Consumo total (kWh)"),t(),e(122,"td",28),r(123,"Energ\xEDa registrada en el per\xEDodo"),t(),e(124,"td",26),r(125),t(),e(126,"td",27),r(127),t(),e(128,"td",27),r(129,"kWh (proyectado)"),t()(),e(130,"tr")(131,"td",26),r(132,"2"),t(),e(133,"td",28),r(134,"Voltaje promedio (V)"),t(),e(135,"td",28),r(136,"Promedio de tensi\xF3n registrada"),t(),e(137,"td",26),r(138),t(),e(139,"td",27),r(140,"\u2014"),t(),e(141,"td",27),r(142,"V"),t()(),e(143,"tr")(144,"td",26),r(145,"3"),t(),e(146,"td",28),r(147,"Corriente promedio (A)"),t(),e(148,"td",28),r(149,"Corriente media por fase"),t(),e(150,"td",26),r(151),t(),e(152,"td",27),r(153,"\u2014"),t(),e(154,"td",27),r(155,"A"),t()(),e(156,"tr")(157,"td",26),r(158,"4"),t(),e(159,"td",28),r(160,"Potencia promedio (kW)"),t(),e(161,"td",28),r(162,"Potencia activa media"),t(),e(163,"td",26),r(164),t(),e(165,"td",27),r(166,"\u2014"),t(),e(167,"td",27),r(168,"kW"),t()(),e(169,"tr")(170,"td",26),r(171,"5"),t(),e(172,"td",28),r(173,"Costo unitario (Q/kWh)"),t(),e(174,"td",28),r(175,"Tarifa aplicada"),t(),e(176,"td",26),r(177),t(),e(178,"td",27),r(179,"\u2014"),t(),e(180,"td",27),r(181,"Q/kWh"),t()(),e(182,"tr")(183,"td",26),r(184,"6"),t(),e(185,"td",28),r(186,"Costo total estimado"),t(),e(187,"td",28),r(188,"Basado en consumo proyectado"),t(),e(189,"td",26),r(190,"\u2014"),t(),e(191,"td",27),r(192),t(),e(193,"td",27),r(194,"Q"),t()()()(),e(195,"c-row")(196,"div",29),r(197),t(),g(198,"div",24),e(199,"c-col",30),r(200," La proyecci\xF3n se calcula en base al promedio m\xF3vil de los \xFAltimos 6 meses de consumo, ajustado por tendencia estacional. "),t(),e(201,"c-col",31)(202,"table",32)(203,"tbody")(204,"tr")(205,"td",28)(206,"strong"),r(207,"Consumo Total Proyectado"),t()(),e(208,"td",27),r(209),t()(),e(210,"tr")(211,"td",28)(212,"strong"),r(213,"Tarifa por kWh"),t()(),e(214,"td",27),r(215),t()(),e(216,"tr")(217,"td",28)(218,"strong"),r(219,"Total Estimado"),t()(),e(220,"td",27)(221,"strong"),r(222),t()()()()()()()()()()(),g(223,"div",5)}if(i&2){let n=k(23),l=k(27),m=k(31),S=k(35);s(7),f(" este ",o.periodo),s(),p("formGroup",o.formRadio1),s(14),p("title","Voltaje")("value",o.voltajePromedio.toFixed(1)+" V"),s(2),p("white",n.inverse())("value",o.voltajePromedio/240*100),s(2),p("title","Amperaje")("value",o.corrientePromedio.toFixed(1)+" A"),s(2),p("white",l.inverse())("value",o.corrientePromedio/200*100),s(2),p("title","Consumo Estimado GTQ")("value","Q "+o.formatearNumero(o.consumoEstimadoGTQ)),s(2),p("white",m.inverse())("value",o.consumoEstimadoGTQ/15e3*100),s(2),p("title","Consumo Estimado KWH")("value",o.formatearNumero(o.consumoEstimadoKWH)+" kWh"),s(2),p("white",S.inverse())("value",o.consumoEstimadoKWH/1e4*100),s(8),p("data",o.lineChartData)("options",o.lineChartOptions),s(7),p("data",o.radarChartData)("options",o.radarChartOptions),s(8),f("Este ",o.periodo),s(28),f("Fecha de Reporte: ",o.obtenerFechaActual()),s(2),f("Periodo Analizado: ",o.obtenerPeriodoAnalisis()),s(7),E(o.obtenerFechaActual()),s(2),f("Tipo de Analisis: ",o.obtenerTipoAnalisis()),s(2),f("Umbral de Referencia: ",o.obtenerUmbralReferencia()),s(),p("hover",!0)("responsive",!0)("striped",!0),s(24),E(o.formatearNumero(o.consumoEstimadoKWH)),s(2),E(o.formatearNumero(o.consumoEstimadoKWH*o.calcularFactorProyeccion(o.periodo))),s(11),E(o.voltajePromedio.toFixed(1)),s(13),E(o.corrientePromedio.toFixed(1)),s(13),E(o.formatearNumero(o.voltajePromedio*o.corrientePromedio/1e3)),s(13),E(o.tarifaActual.toFixed(2)),s(15),E(o.formatearNumero(o.consumoEstimadoGTQ)),s(4),p("ngStyle",W(46,he,o.estaEnLimites()?"green":"red")),s(),f(" ",o.obtenerMensajeEstado()),s(5),p("hover",!0)("responsive",!0)("color",o.estaEnLimites()?"success":"danger"),s(7),f("",o.formatearNumero(o.consumoEstimadoKWH)," kWh"),s(6),f("Q ",o.tarifaActual.toFixed(2)),s(7),f("Q ",o.formatearNumero(o.consumoEstimadoGTQ))}},dependencies:[L,j,de,se,ae,ne,ie,re,oe,Z,$,K,q,Q,O,Y,z,le,ue,ce,pe,te,me],encapsulation:2});var ge=D;export{ge as ButtonGroupsComponent};
